<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ثبت سفارش</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.12.1/font/bootstrap-icons.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Tahoma', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding-bottom: 20px;
        }
        
        @media screen and (max-width: 576px){
            .col-xs-1 { width: 8.33%; }
            .col-xs-2 { width: 16.66%; }
            .col-xs-3 { width: 25%; }
            .col-xs-4 { width: 33.33%; }
            .col-xs-5 { width: 41.66%; }
            .col-xs-6 { width: 50%; }
            .col-xs-7 { width: 58.33%; }
            .col-xs-8 { width: 66.66%; }
            .col-xs-9 { width: 75%; }
            .col-xs-10 { width: 83.33%; margin: auto; }
            .col-xs-11 { width: 91.66%; }
            .col-xs-12 { width: 100%; }
        }

        @media screen and (min-width: 576px){
            .col-sm-1 { width: 8.33%; }
            .col-sm-2 { width: 16.66%; }
            .col-sm-3 { width: 25%; }
            .col-sm-4 { width: 33.33%; }
            .col-sm-5 { width: 41.66%; }
            .col-sm-6 { width: 50%; }
            .col-sm-7 { width: 58.33%; }
            .col-sm-8 { width: 66.66%; }
            .col-sm-9 { width: 75%; }
            .col-sm-10 { width: 83.33%; }
            .col-sm-11 { width: 91.66%; }
            .col-sm-12 { width: 100%; }
        }

        @media screen and (min-width: 768px){
            .col-md-1 { width: 8.33%; }
            .col-md-2 { width: 16.66%; }
            .col-md-3 { width: 25%; }
            .col-md-4 { width: 33.33%; }
            .col-md-5 { width: 41.66%; }
            .col-md-6 { width: 50%; }
            .col-md-7 { width: 58.33%; }
            .col-md-8 { width: 66.66%; }
            .col-md-9 { width: 75%; }
            .col-md-10 { width: 83.33%; }
            .col-md-11 { width: 91.66%; }
            .col-md-12 { width: 100%; }
        }

        @media screen and (min-width: 992px){
            .col-lg-1 { width: 8.33%; }
            .col-lg-2 { width: 16.66%; }
            .col-lg-3 { width: 25%; }
            .col-lg-4 { width: 33.33%; }
            .col-lg-5 { width: 41.66%; }
            .col-lg-6 { width: 50%; }
            .col-lg-7 { width: 58.33%; }
            .col-lg-8 { width: 66.66%; }
            .col-lg-9 { width: 75%; }
            .col-lg-10 { width: 83.33%; }
            .col-lg-11 { width: 91.66%; }
            .col-lg-12 { width: 100%; }
        }

        @media screen and (min-width: 1200px){
            .col-xl-1 { width: 8.33%; }
            .col-xl-2 { width: 16.66%; }
            .col-xl-3 { width: 25%; }
            .col-xl-4 { width: 33.33%; }
            .col-xl-5 { width: 41.66%; }
            .col-xl-6 { width: 50%; }
            .col-xl-7 { width: 58.33%; }
            .col-xl-8 { width: 66.66%; }
            .col-xl-9 { width: 75%; }
            .col-xl-10 { width: 83.33%; }
            .col-xl-11 { width: 91.66%; }
            .col-xl-12 { width: 100%; }
        }

        .container-header-register {
            width: 80%;
            height: 50px;
            margin: 20px auto;
        }
        
        .row {   
            display: flex;
            flex-wrap: wrap;
        }
        
        .box-header-register {
            margin: 5px;
        }

        .container-hero-register {
            width: 80%;
            margin: 20px auto;
        }
        
        .box-hero-register {
            border: 2px solid #004080;
            border-radius: 8px;
            margin: 10px;
            padding: 30px 20px;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .text-title-left-register {
            font-size: 26px;
            font-weight: bold;
            color: #004080;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .icons-register {
            font-size: 32px;
            color: #004080;
            display: block;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .form-label {
            padding-right: 30px;
            font-size: 18px;
            color: rgb(72, 155, 72);
            width: 30%;
            text-align: right;
        }
        
        .form-input {
            padding: 12px;
            width: 200px;
            text-align: right;
            font-size: 16px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: rgb(72, 155, 72);
            box-shadow: 0 0 8px rgba(72, 155, 72, 0.3);
        }
        
        .radio-group {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70%;
            gap: 30px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
        }
        
        .radio-option input[type="radio"] {
            margin-left: 8px;
            transform: scale(1.2);
        }
        
        .radio-option label {
            font-size: 16px;
        }
        
        .checkbox-group {
            display: flex;
            width: 70%;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
        }
        
        .checkbox-option input[type="checkbox"] {
            margin-left: 8px;
            transform: scale(1.2);
        }
        
        .select-box {
            padding: 12px;
            width: 200px;
            text-align: right;
            font-size: 16px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            border: 2px solid #ddd;
            border-radius: 5px;
            transition: all 0.3s;
            background-color: white;
        }
        
        .select-box:focus {
            outline: none;
            border-color: rgb(72, 155, 72);
            box-shadow: 0 0 8px rgba(72, 155, 72, 0.3);
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        
        .btn-submit {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            background-color: rgb(72, 155, 72);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-submit:hover {
            background-color: rgb(60, 130, 60);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-reset {
            padding: 12px 30px;
            border: 1px solid #ff6b6b;
            border-radius: 5px;
            background-color: white;
            color: #ff6b6b;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-reset:hover {
            background-color: #ff6b6b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-back {
            border: 1px solid red;
            padding: 12px 30px;
            border-radius: 5px;
            margin: 20px auto;
            display: block;
            background-color: white;
            color: red;
            cursor: pointer;
            transition: all 0.5s;
            font-size: 16px;
            font-weight: bold;
        }
        
        .btn-back:hover {
            background-color: red;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .message {
            padding: 15px;
            margin: 20px auto;
            width: 80%;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .file-input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }
        
        .file-info {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            text-align: right;
        }
        
        @media (max-width: 768px) {
            .form-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-label {
                width: 100%;
                margin-bottom: 8px;
                padding-right: 0;
            }
            
            .form-input, .select-box, .file-input {
                width: 100%;
            }
            
            .radio-group, .checkbox-group {
                width: 100%;
                justify-content: flex-start;
            }
            
            .radio-option {
                width: auto;
                margin-left: 20px;
            }
            
            .container-header-register, .container-hero-register {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container-header-register">
        <div class="row">
            <div class="col-xs-4 col-sm-4 col-md-4">
                <div class="box-header-register">
                    <i class="bi bi-basket" title="سبد خرید" style="color: green; cursor: pointer; font-size: 25px; padding-left: 10px;"></i>
                </div>
            </div>
            <div class="col-xs-4 col-sm-4 col-md-4">
                <div class="box-header-register"></div>
            </div>
            <div class="col-xs-4 col-sm-4 col-md-4">
                <div class="box-header-register"></div>
            </div>
        </div>
    </div>

    <?php
    $errors = [];
    $success = false;
    $formData = [];

    if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $fullname = trim($_POST['fullname'] ?? '');
        if (empty($fullname)) {
            $errors['fullname'] = "نام و نام خانوادگی الزامی است.";
        } else {
            $formData['fullname'] = htmlspecialchars($fullname);
        }

        $gender = $_POST['gender'] ?? '';
        if (empty($gender)) {
            $errors['gender'] = "انتخاب جنسیت الزامی است.";
        } else {
            $formData['gender'] = $gender;
        }

        $productType = $_POST['productType'] ?? '';
        if (empty($productType)) {
            $errors['productType'] = "انتخاب نوع محصول الزامی است.";
        } else {
            $formData['productType'] = $productType;
        }

        $productName = trim($_POST['productName'] ?? '');
        if (empty($productName)) {
            $errors['productName'] = "نام محصول الزامی است.";
        } else {
            $formData['productName'] = htmlspecialchars($productName);
        }

        $quantity = $_POST['quantity'] ?? '';
        if (empty($quantity)) {
            $errors['quantity'] = "تعداد الزامی است.";
        } elseif (!is_numeric($quantity) || $quantity <= 0) {
            $errors['quantity'] = "تعداد باید عدد مثبت باشد.";
        } else {
            $formData['quantity'] = (int)$quantity;
        }

        $options = $_POST['options'] ?? [];
        $formData['options'] = is_array($options) ? $options : [];

        $paymentMethod = $_POST['paymentMethod'] ?? '';
        if (empty($paymentMethod)) {
            $errors['paymentMethod'] = "انتخاب روش پرداخت الزامی است.";
        } else {
            $formData['paymentMethod'] = $paymentMethod;
        }

        $description = trim($_POST['description'] ?? '');
        if (!empty($description)) {
            $formData['description'] = htmlspecialchars($description);
        }

        if (isset($_FILES['personalPhoto']) && $_FILES['personalPhoto']['error'] !== UPLOAD_ERR_NO_FILE) {
            $file = $_FILES['personalPhoto'];
            
            if ($file['error'] !== UPLOAD_ERR_OK) {
                if ($file['error'] == UPLOAD_ERR_INI_SIZE || $file['error'] == UPLOAD_ERR_FORM_SIZE) {
                    $errors['personalPhoto'] = "حجم فایل بسیار بزرگ است.";
                } else {
                    $errors['personalPhoto'] = "خطا در آپلود فایل.";
                }
            } else {
                $maxFileSize = 200 * 1024;
                if ($file['size'] > $maxFileSize) {
                    $errors['personalPhoto'] = "حجم فایل نباید بیشتر از 200 کیلوبایت باشد.";
                }
                
                $allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/gif'];
                $fileType = mime_content_type($file['tmp_name']);
                if (!in_array($fileType, $allowedTypes)) {
                    $errors['personalPhoto'] = "فقط فایل‌های تصویری مجاز هستند.";
                }
                
                if (!isset($errors['personalPhoto'])) {
                    $uploadDir = 'uploads/';
                    if (!is_dir($uploadDir)) {
                        mkdir($uploadDir, 0755, true);
                    }
                    
                    $fileName = uniqid() . '_' . basename($file['name']);
                    $uploadPath = $uploadDir . $fileName;
                    
                    if (move_uploaded_file($file['tmp_name'], $uploadPath)) {
                        $formData['personalPhoto'] = $uploadPath;
                    } else {
                        $errors['personalPhoto'] = "خطا در ذخیره فایل.";
                    }
                }
            }
        }

        if (empty($errors)) {
            $success = true;
            $successMessage = "ثبت سفارش با موفقیت انجام شد!";
            $formData = [];
        }
    }
    ?>

    <?php if ($success): ?>
        <div class="message success">
            <?php echo $successMessage; ?>
        </div>
    <?php endif; ?>

    <div class="container-hero-register">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <div class="box-hero-register">
                    <p class="text-title-left-register">ثبت سفارش</p>
                    <i class="bi bi-cart4 icons-register"></i>
                    
                    <form action="" method="POST" enctype="multipart/form-data">
                        <div class="form-group">
                            <input type="text" class="form-input" id="fullname" name="fullname" 
                                   placeholder="... نام و نام خانوادگی را وارد کنید" 
                                   value="<?php echo htmlspecialchars($formData['fullname'] ?? ''); ?>"
                                   required>
                            <label class="form-label">:نام و نام خانوادگی</label>
                            <?php if (isset($errors['fullname'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['fullname']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="male" name="gender" value="مرد" 
                                           <?php echo ($formData['gender'] ?? '') == 'مرد' ? 'checked' : ''; ?> required>
                                    <label for="male">مرد</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="female" name="gender" value="زن"
                                           <?php echo ($formData['gender'] ?? '') == 'زن' ? 'checked' : ''; ?>>
                                    <label for="female">زن</label>
                                </div>
                            </div>
                            <label class="form-label">:جنسیت</label>
                            <?php if (isset($errors['gender'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['gender']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" id="accessory" name="productType" value="لوازم جانبی"
                                           <?php echo ($formData['productType'] ?? '') == 'لوازم جانبی' ? 'checked' : ''; ?> required>
                                    <label for="accessory">لوازم جانبی</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" id="software" name="productType" value="پک نرم افزاری"
                                           <?php echo ($formData['productType'] ?? '') == 'پک نرم افزاری' ? 'checked' : ''; ?>>
                                    <label for="software">پک نرم افزاری</label>
                                </div>
                            </div>
                            <label class="form-label">:نوع محصول</label>
                            <?php if (isset($errors['productType'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['productType']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <input type="text" class="form-input" id="productName" name="productName" 
                                   placeholder="... نام محصول را وارد کنید"
                                   value="<?php echo htmlspecialchars($formData['productName'] ?? ''); ?>"
                                   required>
                            <label class="form-label">:نام محصول</label>
                            <?php if (isset($errors['productName'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['productName']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <input type="number" class="form-input" id="quantity" name="quantity" 
                                   placeholder="... تعداد را وارد نمایید" min="1"
                                   value="<?php echo $formData['quantity'] ?? ''; ?>"
                                   required>
                            <label class="form-label">:تعداد</label>
                            <?php if (isset($errors['quantity'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['quantity']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <div class="checkbox-option">
                                    <input type="checkbox" id="warranty" name="options[]" value="گارانتی" <?php echo in_array('گارانتی', $formData['options'] ?? []) ? 'checked' : ''; ?>>
                                    <label for="warranty">گارانتی اضافه</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="installation" name="options[]" value="نصب و راه اندازی" <?php echo in_array('نصب و راه اندازی', $formData['options'] ?? []) ? 'checked' : ''; ?>>
                                    <label for="installation">نصب و راه اندازی</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="delivery" name="options[]" value="تحویل رایگان" <?php echo in_array('تحویل رایگان', $formData['options'] ?? []) ? 'checked' : ''; ?>>
                                    <label for="delivery">تحویل رایگان</label>
                                </div>
                                <div class="checkbox-option">
                                    <input type="checkbox" id="support" name="options[]" value="پشتیبانی فنی" <?php echo in_array('پشتیبانی فنی', $formData['options'] ?? []) ? 'checked' : ''; ?>>
                                    <label for="support">پشتیبانی فنی</label>
                                </div>
                            </div>
                            <label class="form-label">:گزینه های اضافی</label>
                        </div>
                        
                        <div class="form-group">
                            <select class="select-box" id="paymentMethod" name="paymentMethod" required>
                                <option value="" disabled <?php echo empty($formData['paymentMethod']) ? 'selected' : ''; ?>>... روش پرداخت را انتخاب کنید</option>
                                <option value="نقدی" <?php echo ($formData['paymentMethod'] ?? '') == 'نقدی' ? 'selected' : ''; ?>>پرداخت نقدی</option>
                                <option value="کارتخوان" <?php echo ($formData['paymentMethod'] ?? '') == 'کارتخوان' ? 'selected' : ''; ?>>پرداخت با کارتخوان</option>
                                <option value="آنلاین" <?php echo ($formData['paymentMethod'] ?? '') == 'آنلاین' ? 'selected' : ''; ?>>پرداخت آنلاین</option>
                                <option value="چکی" <?php echo ($formData['paymentMethod'] ?? '') == 'چکی' ? 'selected' : ''; ?>>پرداخت چکی</option>
                                <option value="اقساطی" <?php echo ($formData['paymentMethod'] ?? '') == 'اقساطی' ? 'selected' : ''; ?>>پرداخت اقساطی</option>
                            </select>
                            <label class="form-label">:روش پرداخت</label>
                            <?php if (isset($errors['paymentMethod'])): ?>
                                <div class="error-message" style="width: 200px;"><?php echo $errors['paymentMethod']; ?></div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="form-group">
                            <textarea class="form-input" id="description" name="description" 
                                      placeholder="... توضیحات اضافی (اختیاری)" 
                                      rows="3" style="width: 200px; height: 100px;"><?php echo htmlspecialchars($formData['description'] ?? ''); ?></textarea>
                            <label class="form-label">:توضیحات</label>
                        </div>
                        
                        <div class="form-group">
                            <div style="width: 200px;">
                                <input type="file" class="file-input" id="personalPhoto" name="personalPhoto" 
                                       accept="image/jpeg,image/png,image/jpg,image/gif">
                                <div class="file-info">حداکثر حجم: 200KB | فرمت‌های مجاز: JPG, PNG, GIF</div>
                                <?php if (isset($errors['personalPhoto'])): ?>
                                    <div class="error-message"><?php echo $errors['personalPhoto']; ?></div>
                                <?php endif; ?>
                            </div>
                            <label class="form-label">:عکس پرسنلی (اختیاری)</label>
                        </div>
                        
                        <div class="buttons-container">
                            <button type="submit" class="btn-submit">ثبت سفارش</button>
                            <button type="reset" class="btn-reset">بازنشانی فرم</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-back" onclick="window.location.href='index.html'">بازگشت</button>

</body>
</html>
